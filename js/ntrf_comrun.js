(function(f){typeof define==="function"?define(f):f()})(function(require,exports,module){function Comrun(){}var Strcom=require("strcom"),Ac=require("ntrf_actives"),$=require("jquery");Comrun.comParse=function(t){var i=$.trim(t).slice(0,1);if("@"===i){var o=Strcom.clear(t),n=o.match(/@([^\[]*)/)[1],e=[],r={};return e=o.match(/\[([^\]]*)/)?o.match(/\[([^\]]*)/)[1].split(","):[],e.forEach(function(t){r[t.split("=")[0]]=t.split("=")[1]}),new Comrun.Active({type:n,options:r})}if("#"===i){var c,m,s,a,o=$.trim(t);c=o.match(/#\[([^\]]*)/)?o.match(/#\[([^\]]*)/)[1]:void 0,s=o.match(/\(([^\)]*)/)?o.match(/\(([^\)]*)/)[1]:void 0,m=o.match(/\{([^\}]*)/)?o.match(/\{([^\}]*)/)[1]:void 0;var u=o.match(/#(\[[^\]]*\]*)*(\([^\)]*\)*)*(\{[^\}]*\}*)*([\s\S]*)/);return u[4]&&(a=u[4]),new Comrun.Dialogue({name:c,voice:m,img:s,fonts:a})}},Comrun.Active=function(t){this.type=t.type,this.options=t.options},Comrun.Active.prototype={run:function(t){Ac[this.type](t,this.options),"xxx"!==this.type&&t.nextCom()}},Comrun.Dialogue=function(t){this.name=t.name,this.voice=t.voice,this.img=t.img,this.fonts=t.fonts},Comrun.Dialogue.prototype={run:function(t){t.setLh(this.img),t.playVoice(this.voice),t.setDia(this.name,this.fonts)}},module.exports=Comrun;});